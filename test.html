<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/assets/style/index.css" />
</head>

<body>
    <div id="slider-container" class="rounded-md overflow-hidden w-full lg:w-2/3 h-screen mx-auto">
        <ul id="slider-list">
            <li>
                <div class="w-full h-full text-6xl flex items-center justify-center bg-blue-400">1</div>
            </li>
            <li>
                <div class="w-full h-full text-6xl flex items-center justify-center bg-blue-400">2</div>
            </li>
            <li>
                <div class="w-full h-full text-6xl flex items-center justify-center bg-blue-400">3</div>
            </li>
            <li>
                <div class="w-full h-full text-6xl flex items-center justify-center bg-blue-400">4</div>
            </li>
            <li>
                <div class="w-full h-full text-6xl flex items-center justify-center bg-blue-400">5</div>
            </li>
            <li>
                <div class="w-full h-full text-6xl flex items-center justify-center bg-blue-400">6</div>
            </li>
        </ul>
    </div>
    <button id="left">left</button>
    <button id="right">right</button>
    <script>
        const slider = function(els, opts = {}) {
            return new(function() {
                this.wrap = typeof els.wrap === "string" ? document.querySelector(els.wrap) : els.wrap;
                this.list = this.wrap.querySelector("ul");
                this.list.style.display = "flex";

                this.update = (opt = {}) => {
                    opts = {...opts,
                        ...opt
                    };
                    this.infinite = opts.infinite || false;
                    this.pos = opts.pos || {
                        value: 0,
                    };
                    this.vert = opts.vert || false;
                    this.move = opts.move || 1;
                    this.cols = opts.cols || 1;
                    this.gap = opts.gap || 0;

                    if (this.infinite) {
                        [...this.list.children].map((e) => e.isCloned && e.remove());

                        const len = this.list.children.length;
                        const firsts = [...this.list.children].reduce((a, e, i) => {
                            if (i < this.cols) {
                                const x = e.cloneNode(true);
                                x.setAttribute("x-clone", true);
                                a.push(x);
                            }
                            return a;
                        }, []);
                        const lasts = [...this.list.children].reduce((a, e, i) => {
                            if (i > len - this.cols - 1) {
                                const x = e.cloneNode(true);
                                x.setAttribute("x-clone", true);
                                a.push(x);
                            }
                            return a;
                        }, []);

                        if (firsts.length)
                            for (let i = 0; i < this.cols; i++) {
                                const current = firsts[i];
                                this.list.insertAdjacentElement("beforeend", current);
                                current.isCloned = true;
                            }

                        if (lasts.length)
                            for (let i = this.cols; i > 0; i--) {
                                const current = lasts[i - 1];
                                this.list.insertAdjacentElement("afterbegin", current);
                                current.isCloned = true;
                            }
                    }

                    this.items = [...this.list.children];
                    this.length = this.items.length;

                    this.__opt = this.vert ?
                        {
                            size: "clientHeight",
                            item: "height",
                            scroll: "scrollTop",
                        } :
                        {
                            size: "clientWidth",
                            item: "width",
                            scroll: "scrollLeft",
                        };

                    this.list.style.width = "";
                    this.list.style.flexDirection = "";
                    this.list.style.width = "";
                    this.list.style.height = "";

                    this.vert ?
                        (this.list.style.width = "100%") && (this.list.style.flexDirection = "column") :
                        (this.list.style.width = "max-content") && (this.list.style.height = "100%");

                    this.itemSize = this.wrap[this.__opt.size] / this.cols - (this.gap * (this.cols - 1)) / this.cols;
                    this.scrollLength = this.itemSize + this.gap;
                    this.list.style.gap = this.gap + "px";

                    for (let i = 0; i < this.length; i++) {
                        this.items[i].style[this.__opt.item] = this.itemSize + "px";
                    }

                    if (!this.__isLunched && this.pos.value === 0) {
                        window.addEventListener("resize", this.update);
                        this.pos.value = this.cols * this.move;
                        this.__isLunched = true;
                    }

                    this.wrap.style.scrollBehavior = "unset";
                    this.wrap[this.__opt.scroll] = this.scrollLength * this.pos.value;
                    this.wrap.style.scrollBehavior = "smooth";
                };

                this.update();

                this.scrollTo = () => {
                    this.wrap[this.__opt.scroll] = this.scrollLength * this.pos.value;
                };

                this.scrollNext = () => {
                    if (this.pos.value >= this.length - this.cols) {
                        if (this.infinite) {
                            this.wrap.style.scrollBehavior = "unset";
                            this.pos.value = this.cols;
                            this.scrollTo();
                            this.pos.value += this.move;
                            this.wrap.style.scrollBehavior = "smooth";
                        } else this.pos.value = 0;
                    } else this.pos.value += this.move;
                    this.scrollTo();
                };

                this.scrollPrev = () => {
                    if (this.pos.value <= 0) {
                        if (this.infinite) {
                            this.wrap.style.scrollBehavior = "unset";
                            this.pos.value = this.length - this.cols - this.cols;
                            this.scrollTo();
                            this.pos.value -= this.move;
                            this.wrap.style.scrollBehavior = "smooth";
                        } else this.pos.value = this.length - this.cols;
                    } else this.pos.value -= this.move;
                    this.scrollTo();
                };

                if (els.prev) {
                    this.prev = typeof els.prev === "string" ? document.querySelector(els.prev) : els.prev;
                    this.prev.onclick = this.scrollPrev;
                }

                if (els.next) {
                    this.next = typeof els.next === "string" ? document.querySelector(els.next) : els.next;
                    this.next.onclick = this.scrollNext;
                }
            })();
        };

        const idx = {
            value: 0,
        };

        const slide = slider({
            wrap: "#slider-container",
            prev: "#left",
            next: "#right",
        }, {
            pos: idx,
            gap: 16,
            cols: 3,
            move: 3,
            vert: true,
            infinite: true,
        });

        const right = document.querySelector("#right");
        const repeatOften = () => {
            setTimeout(() => {
                right.click();
                requestAnimationFrame(repeatOften);
            }, 3000);
        };
        requestAnimationFrame(repeatOften);

        // i < cols
        // len - i - 1
        // i > len + cols - 1
        // len - cols - i - 1
    </script>
</body>

</html>